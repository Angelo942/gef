name: "Discord Notification"
on: [push, pull_request, issues]
env:
  DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: GEF Push Notification
        uses: Ilshidur/action-discord@0.3.2
        if: github.event_name == 'push' && github.repository_owner == 'hugsy'
        with:
          args: |
            ${{ github.actor }} pushed to `${{ github.event.ref }}`
        env:
          DISCORD_EMBEDS: '{"embeds": [{"author": { "name": "${{ github.actor }}", "url": "{{ EVENT_PAYLOAD.compare }}", "icon_url": "${{ github.actor.avatar_url }}" } , "title": "New Push from ${{ github.actor}}: `{{ EVENT_PAYLOAD.push.ref }}` ", "description": "Commit delta: {{ EVENT_PAYLOAD.push.before }} â†’ {{ EVENT_PAYLOAD.push.before }}\nCompare changes: {{ EVENT_PAYLOAD.push.compare }}\nCommits: ${{ join(EVENT_PAYLOAD.push.commits.*.url) }}"}]}'

      - name: GEF PR Notification
        uses: Ilshidur/action-discord@0.3.2
        if: github.event_name == 'pull_request' && github.event.action == 'opened' && github.repository_owner == 'hugsy'
        with:
          args: |
            ${{ github.actor }} created a new Pull Request (`#${{ github.event.pull_request.number }}`)
        env:
          DISCORD_EMBEDS: '{"embeds": [{"author": { "name": "${{ github.actor }}", "url": "{{ EVENT_PAYLOAD.pull_request.html_url }}", "icon_url": "${{ github.actor.avatar_url }}" } , "title": "{{ EVENT_PAYLOAD.pull_request.title }}", "description": "{{ EVENT_PAYLOAD.pull_request.body }} "}]}'

      - name: GEF Issue Notification
        uses: Ilshidur/action-discord@0.3.2
        if: github.event_name == 'issues' && github.event.action == 'opened' && github.repository_owner == 'hugsy'
        with:
          args: |
            ${{ github.actor }} created a new Issue (`#${{ github.event.issue.number }}`)
        env:
          DISCORD_EMBEDS: '{"embeds": [{"author": { "name": "${{ github.actor }}", "url": "{{ EVENT_PAYLOAD.issue.html_url }}", "icon_url": "${{ github.actor.avatar_url }}" , "title": "{{ EVENT_PAYLOAD.issue.title }}", "description": "{{ EVENT_PAYLOAD.issue.body }}"}]}'

